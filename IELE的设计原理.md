IELE作为一个统一的，更低层次的平台，用于翻译和执行高级语言的智能合约。

IELE设计来源于K框架中定义数十种语言经验，基于K框架定义了两个虚拟机：

-  KEVM，即EVM语义；
-  KLLVM，即LLVM语义。

EVM基于栈，而IELE类似LLVM基于寄存器。类似于LLVM也直接支持函数  、寄存器数量无限制、整形值无限制。

在gas计算方面的精细处理是是其设计的关键。

#  1.设计背景

1.  作为统一用于翻译、执行高级语言编写的智能合约底层平台，这些合约也可通过ABI交互

ABI是IELE的核心元素，而不仅仅是基于它的一个协议。由于LLVM的成功，长远看无限制的寄存器集整形值，使得高级语言的编译更佳高效。

而许多LLVM优化确实在持续进行中。因此，LELE尽可能遵循LLVM的设计原则。团队中也有来自伊尼诺伊大学(LLVM的起源地)的LLVM专家。

2.  为所有语言提供统一的gas模型

IELE的gas计算总体设计理念是 “无约束，但需为消费付费”。如IELE程序使用越多的寄存器，就会消费越多的gas。

或者运行时计算数值越大、使用内存越多，也会消费越多的gas。等等。。。

3.  更容易编写安全的智能合约

包含编写智能合约需遵守的规范、及更容易开发自动化技术。该技术以数学方式验证／证明智能合约符合规范。

例如将一个计算数字压栈，将其作为地址跳转。这样验证困难、且由于智能合约模式导致安全性减弱。

LELE类似LLVM，命名了label，跳转语句智能跳转到那些label。

避免使用栈边界、不用担心栈溢出、算术溢出，这是的智能合约的规范与验证更加容易。

4.  形式化语义及解释器

像KEVM一样，使用K框架定义、验证集评估EVM的形式化语义。IELE的设计也是使用K框架的形式化形式。

为K提供一个快速执行后端(基于LLVM)目前处于开发中，预计解释器自动获得从IELE语义，将足够充分作为IELE的补充实现。

#  2.IELE相对于EVM设计的差异

#  3.IELE相对于LLVM设计的差异

1.   类型系统

不同于LLVM支持整形、浮点型有限精度。

IELE支持任意精度，但目前只支持整形。足以描述EVM，未来支持类似LLVM的聚合类型如数组、结构体以及高级函数类型。

2.  SSA

IELE寄存器非SSA形式，即其可以多次分配而不需要phi节点。

其旨在支持智能合约的解释性语言。为减少程序的gas消耗，尽量少的使用寄存器。这亦即表明与LLVM  SSA的不同之处。

生成IELE的编译器仍然可以在内部使用SSA IELE便于优化程序，但在最终的IELE程序或者手写代码中不会强制转换为SSA来优化寄存器的使用。

3.  控制流

LLVM对BB块结构的约束，代码被组织成包含显式、静态化的后继／前驱最大BB块控制流图(CFG)。

IELE会弱化这个约束，维持静态label作为唯一允许的跳转地址，同时允许执行一个BB块到另一个BB的fall-through。

而LLVM是BB块的第一条指令只能通过跳转到达，而且每一个BB块最后一条指令只能是控制流指令。

弱化这个约束的目的是，减少IELE程序的代码体积。因为LLVM程序中的这些约束会增加额外的分支指令。

4.  位移

由于IELE是任意精度的有符号整型，因此不用shr/shl指令，而是采用带符号的位移量来表示位移。


参考：[https://github.com/runtimeverification/iele-semantics/blob/master/Design.md]

